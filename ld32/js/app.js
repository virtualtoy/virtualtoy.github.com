// Tue, 28 Apr 2015 15:16:06 GMT
"use strict";function init(){stage=new createjs.Stage("app-canvas"),createjs.Ticker.framerate=30,createjs.Ticker.timingMode=createjs.Ticker.RAF_SYNCHED,createjs.Ticker.addEventListener("tick",tick),queue=new createjs.LoadQueue,queue.on("complete",onLoadComplete,this),queue.loadManifest(["img/game_background.jpg","img/main_menu_background.jpg","img/credits_background.jpg","img/help_background.jpg","img/buttons.png","img/victim_male.jpg","img/victim_female.jpg","img/progress_bar_background.png","img/progress_bar.png","img/bitmap_font.png","img/result_popup.png","img/twitter_button.png"].concat(ALL_IMAGES).concat(ALL_FACES))}function onLoadComplete(){window.__stopPreloader__(),createjs.MotionGuidePlugin.install(),createjs.Touch.isSupported()&&createjs.Touch.enable(stage,!0),openMainMenu()}function openGame(){scene&&scene.dispose(),scene=new Game(stage)}function openMainMenu(){scene&&scene.dispose(),scene=new MainMenu(stage)}function tick(){stage.update(),scene&&scene.update()}var stage,queue,scene,ALL_IMAGES=["img/images2.jpg","img/images3.jpg","img/images5.jpg","img/images9.jpg","img/images10.jpg","img/images11.jpg","img/images12.jpg","img/images13.jpg","img/images14.jpg","img/images15.jpg","img/images20.jpg","img/images21.jpg","img/images22.jpg","img/images23.jpg","img/images25.jpg","img/images26.jpg","img/images27.jpg","img/images29.jpg"],ALL_FACES=["img/face_0.png","img/face_1.png","img/face_2.png","img/face_3.png","img/face_4.png","img/face_5.png","img/face_6.png","img/face_7.png","img/face_8.png","img/face_9.png"];!function(){function a(a){for(var b=new createjs.Point,c=.44,d=54,e=256,f=0,g=133,h=162,i=7,j=24,k=5,l=ALL_IMAGES.slice();l.length>k;){var m=Math.floor(Math.random()*l.length);l.splice(m,1)}var n=[],o=new createjs.Container,p=[],q=[],r=-1,s=1,t=[];this.getView=function(){return o},this.update=function(){a.isCompleted()||(this.updateLine(!0),this.updateLine(!1))},this.updateLine=function(a){var b,c,g=a?p:q,h=a?r:s;if(0>h){for(b=0;b<g.length;b++)if(0==b)c=g[b].x,1>c?g[b].x+=h:g[b].x-=c/2;else{var i=g[b-1].x;c=g[b].x-i-d,g[b].x=i+d+c/2}var j=g[0];j.x<f-j.getTransformedBounds().width&&(o.removeChild(j),g.shift(),this.createBitmap(a))}else if(h>0){for(b=g.length-1;b>=0;b--)if(b==g.length-1)c=e-g[b].getTransformedBounds().width-g[b].x,1>c?g[b].x+=h:g[b].x+=c/2;else{var k=g[b+1].x;c=k-g[b].x-d,g[b].x=k-d-c/2}var l=g[g.length-1];l.x>e&&(o.removeChild(l),g.pop(),this.createBitmap(a))}},this.createBitmap=function(a){0==n.length&&(n=l.slice());var b=Math.floor(Math.random()*n.length),d=n.splice(b,1)[0],i=new createjs.Bitmap(queue.getResult(d));i.__conveyorBitmapImage__=d,i.scaleX=i.scaleY=c;var j=a?0:i.image.height/2;i.sourceRect=new createjs.Rectangle(0,j,i.image.width,i.image.height/2),o.addChild(i);var k=a?p:q,m=a?r:s;0>m?i.x=e:i.x=f-i.getTransformedBounds().width,i.y=a?g:h,0>m?k.push(i):k.unshift(i)},this.hitTest=function(a,b){var c=this.findBitmapHitTest(a,b,p)||this.findBitmapHitTest(a,b,q);c&&this.selectBitmap(c)},this.findBitmapHitTest=function(a,c,d){for(var e=0;e<d.length;e++){var f=d[e];if(f.globalToLocal(a,c,b),f.hitTest(b.x,b.y))return f}return null},this.selectBitmap=function(a){for(var b=-1!=p.indexOf(a),c=b?q:p,d=0;d<c.length;d++){var e=c[d],f=Math.abs(e.x-a.x);if(j>f&&a.__conveyorBitmapImage__==e.__conveyorBitmapImage__)return void this.removeBitmaps(b?a:e,b?e:a)}this.removeBitmap(a,b)},this.removeBitmap=function(b,c){var d=c?p:q;d.splice(d.indexOf(b),1),this.createBitmap(c);var e=b.getTransformedBounds();b.regX=e.width/2,b.regY=e.height/2;var f=(10*Math.random()+10)*(Math.random()<.5?-1:1),g=b.x,h=b.y,i=[g,h,g+f/2,10*Math.random()+80,g+f,200];o.setChildIndex(b,o.numChildren-1),createjs.Tween.get(b).to({guide:{path:i},rotation:300*Math.random()-150},400).call(function(){o.removeChild(b)}.bind(this)),a.victimUp()},this.removeBitmaps=function(b,d){p.splice(p.indexOf(b),1),q.splice(q.indexOf(d),1),o.removeChild(b),o.removeChild(d);var e=new createjs.Bitmap(queue.getResult(b.__conveyorBitmapImage__));o.addChild(e),e.scaleX=e.scaleY=c,e.x=b.x,e.y=b.y,createjs.Tween.get(e).to({x:128,y:0,scaleX:1,scaleY:1},400,createjs.Ease.backOut).call(function(){t.length&&o.removeChild(t.pop()),t.push(e)}.bind(this)),this.createBitmap(!0),this.createBitmap(!1),a.victimDown();var f=Math.random();.2>f?(r=-r,s=-s):.4>f&&(r=(.5*Math.random()+1)*(r>0?1:-1),s=(.5*Math.random()+1)*(s>0?1:-1))};for(var u=0;i>u;u++)this.createBitmap(!0),this.createBitmap(!1)}window.Conveyor=a}(),function(){function a(a){function b(a){g.isDead()||k.hitTest(a.stageX,a.stageY)}function c(){var a=Math.floor((Date.now()-l)/1e3),b=new createjs.Container;b.addChild(new createjs.Bitmap(queue.getResult("img/result_popup.png")));var c={images:[queue.getResult("img/buttons.png")],frames:{width:85,height:26},animations:{startUp:0,startDown:1,helpUp:2,helpDown:3,creditsUp:4,creditsDown:5}},f=new createjs.SpriteSheet(c),g=new createjs.Sprite(f);g.x=85,g.y=140,b.addChild(g),new createjs.ButtonHelper(g,"startDown","startUp","startUp");var h=new createjs.Bitmap(queue.getResult("img/twitter_button.png"));h.x=59,h.y=168,h.on("click",function(){window.open("https://twitter.com/virtualtoy")}),b.addChild(h),c={images:[queue.getResult("img/bitmap_font.png")],frames:{width:18,height:19},animations:{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9}},f=new createjs.SpriteSheet(c);var i=new createjs.BitmapText(a.toString(),f);i.x=(256-i.getBounds().width)/2,i.y=50,b.addChild(i);var j=a;try{if(window.localStorage){var k=parseFloat(window.localStorage.getItem("confessomatic_besttime"));isNaN(k)?window.localStorage.setItem("confessomatic_besttime",a):k>a?window.localStorage.setItem("confessomatic_besttime",a):j=k}}catch(m){}var n=new createjs.Shape;n.alpha=.8,n.graphics.beginFill("tomato").rect(0,0,256,192).endFill(),e.addChild(n),createjs.Tween.get(n).to({alpha:0},1500).call(function(){e.removeChild(n)});var o=new createjs.BitmapText(j.toString(),f);o.x=(256-o.getBounds().width)/2,o.y=104,b.addChild(o),b.y=-192,e.addChild(b),createjs.Tween.get(b).wait(1e3).to({y:0},800,createjs.Ease.bounceOut).call(function(){g.on("click",d)})}function d(){openGame()}var e=new createjs.Container;a.addChild(e);var f=new createjs.Bitmap(queue.getResult("img/game_background.jpg"));e.addChild(f);var g=new Victim;e.addChild(g.getView());var h=new createjs.Bitmap(queue.getResult("img/progress_bar_background.png"));h.x=3,h.y=116,e.addChild(h);var i=new createjs.Shape;i.graphics.beginFill("red"),i.graphics.drawRect(0,0,123,13),i.cache(0,0,123,13),i.scaleX=.5;var j=new createjs.Bitmap(queue.getResult("img/progress_bar.png"));j.x=3,j.y=116,j.filters=[new createjs.AlphaMaskFilter(i.cacheCanvas)],j.cache(0,0,123,13),e.addChild(j);var k=new Conveyor(this);e.addChild(k.getView());var l=Date.now(),m=!1;e.on("mousedown",b.bind(this)),this.update=function(){g.update(),k.update(),i.cache(0,0,Math.max(1,123*g.getInsanity()),13),j.cache(0,0,123,13),this.isCompleted()&&!m&&(m=!0,c())},this.victimDown=function(){g.down()},this.victimUp=function(){g.up()},this.isCompleted=function(){return g.isDead()},this.dispose=function(){a.removeChild(e)}}window.Game=a}(),function(){function a(a){function b(a,b,c,e,f){var g=new createjs.Sprite(a);return g.x=b,g.y=c,d.addChild(g),new createjs.ButtonHelper(g,e,f,f),g}function c(a){switch(a.target){case h:createjs.Sound.registerPlugins([createjs.WebAudioPlugin]),createjs.Sound.alternateExtensions=["ogg"],createjs.Sound.registerSound("snd/One-eyed Maestro_loop.mp3","sound"),createjs.Sound.on("fileload",function(a){createjs.Sound.play("sound",{loop:-1})}),openGame();break;case i:l.visible=!0;break;case j:k.visible=!0;break;case l:case k:a.target.visible=!1}}var d=new createjs.Container;a.addChild(d);var e=new createjs.Bitmap(queue.getResult("img/main_menu_background.jpg"));d.addChild(e);var f={images:[queue.getResult("img/buttons.png")],frames:{width:85,height:26},animations:{startUp:0,startDown:1,helpUp:2,helpDown:3,creditsUp:4,creditsDown:5}},g=new createjs.SpriteSheet(f),h=b(g,85,102,"startDown","startUp"),i=b(g,85,126,"helpUp","helpDown"),j=b(g,85,150,"creditsUp","creditsDown"),k=new createjs.Bitmap(queue.getResult("img/credits_background.jpg"));k.visible=!1,d.addChild(k);var l=new createjs.Bitmap(queue.getResult("img/help_background.jpg"));l.visible=!1,d.addChild(l),d.on("click",c.bind(this)),this.update=function(){},this.dispose=function(){a.removeChild(d)}}window.MainMenu=a}(),function(){function a(){var a=.09,b=3e-4,c=new createjs.Container,d=new createjs.Bitmap(queue.getResult(Math.random()<.5?"img/victim_male.jpg":"img/victim_female.jpg"));c.addChild(d);var e=new createjs.Bitmap(queue.getResult(ALL_FACES[0]));e.x=69,e.y=45,c.addChild(e);var f=0,g=!1,h=!1;this.update=function(){if(1!=f){g||h?(g&&(f+=a,g=!1),h&&(f-=a,h=!1)):f-=b,0>f?f=0:f>1&&(f=1);var c=Math.floor(f*(ALL_FACES.length-1));e.image=queue.getResult(ALL_FACES[c])}},this.down=function(){g=!0;for(var a=createjs.Tween.get(c,{override:!0}),b=5;b>=0;b--)a.to({x:(Math.random()-.5)*b,y:(Math.random()-.5)*b}).wait(100);a.call(function(){c.x=c.y=0})},this.up=function(){h=!0},this.getInsanity=function(){return f},this.isDead=function(){return f>=1},this.getView=function(){return c}}window.Victim=a}();